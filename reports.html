</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics - Regenix</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 3em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .page-subtitle {
            font-size: 1.3em;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Report Types */
        .report-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .report-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .report-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .report-card:hover::before {
            left: 100%;
        }

        .report-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .report-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: white;
            margin: 0 auto 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .report-icon.daily {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .report-icon.weekly {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .report-icon.monthly {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .report-icon.progress {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .report-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }

        .report-description {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }

        .report-features {
            list-style: none;
            margin-bottom: 25px;
        }

        .report-features li {
            padding: 8px 0;
            color: #5a6c7d;
            position: relative;
            padding-left: 25px;
        }

        .report-features li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1.1em;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Report Display */
        .report-display {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .report-display.show {
            display: block;
            animation: slideInUp 0.5s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .report-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e0e6ed;
        }

        .report-header h2 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .report-meta {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(79, 172, 254, 0.4);
        }

        .stat-card.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* Chart Section */
        .chart-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #e0e6ed;
        }

        .chart-title {
            font-size: 1.6em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #dee2e6;
            margin-bottom: 20px;
        }

        .chart-placeholder {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.2em;
        }

        /* Analysis Section */
        .analysis-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .analysis-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .analysis-content {
            color: #34495e;
            line-height: 1.7;
            font-size: 1.1em;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .analysis-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 12px;
        }

        .analysis-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }

        /* Export Options */
        .export-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .export-title {
            font-size: 1.6em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 12px 25px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            justify-content: center;
        }

        .export-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 73, 94, 0.3);
        }

        .export-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .export-btn.primary:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Date Range Picker */
        .date-picker {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .date-picker-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .date-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .date-group {
            display: flex;
            flex-direction: column;
        }

        .date-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .date-group input {
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .date-group input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .date-presets {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 2px solid #e0e6ed;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .preset-btn:hover, .preset-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e0e6ed;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                padding: 20px 15px;
            }

            .page-title {
                font-size: 2.5em;
            }

            .report-types {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .export-buttons {
                flex-direction: column;
                align-items: center;
            }

            .export-btn {
                width: 100%;
                max-width: 250px;
            }

            .date-inputs {
                grid-template-columns: 1fr;
            }

            .date-presets {
                flex-direction: column;
                align-items: center;
            }

            .preset-btn {
                width: 100%;
                max-width: 200px;
                text-align: center;
            }

            .nav-container {
                flex-direction: column;
                gap: 15px;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            .navbar, .export-section, .nav-buttons {
                display: none !important;
            }
            
            body {
                background: white !important;
            }
            
            .report-display {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 20px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">üè•</div>
                <span>Regenix</span>
            </div>
            <div class="nav-buttons">
                <a href="dashboard.html" class="nav-btn">‚Üê Dashboard</a>
                <button class="nav-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Reports & Analytics</h1>
            <p class="page-subtitle">
                Comprehensive insights into your rehabilitation progress with AI-powered analysis
            </p>
        </div>

        <!-- Date Range Picker -->
        <div class="date-picker">
            <h3 class="date-picker-title">üìÖ Select Report Period</h3>
            <div class="date-inputs">
                <div class="date-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate">
                </div>
                <div class="date-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            <div class="date-presets">
                <button class="preset-btn active" onclick="setDatePreset('today')">Today</button>
                <button class="preset-btn" onclick="setDatePreset('week')">Last 7 Days</button>
                <button class="preset-btn" onclick="setDatePreset('month')">Last 30 Days</button>
                <button class="preset-btn" onclick="setDatePreset('quarter')">Last 3 Months</button>
                <button class="preset-btn" onclick="setDatePreset('year')">Last Year</button>
            </div>
        </div>

        <!-- Report Types -->
        <div class="report-types">
            <div class="report-card" onclick="generateReport('daily')">
                <div class="report-icon daily">üìÖ</div>
                <h3 class="report-title">Daily Reports</h3>
                <p class="report-description">
                    Track your daily rehabilitation activities and immediate progress indicators
                </p>
                <ul class="report-features">
                    <li>Daily session summaries</li>
                    <li>Performance metrics</li>
                    <li>Goal achievement status</li>
                    <li>Quick insights</li>
                </ul>
                <button class="generate-btn">Generate Daily Report</button>
            </div>

            <div class="report-card" onclick="generateReport('weekly')">
                <div class="report-icon weekly">üìà</div>
                <h3 class="report-title">Weekly Reports</h3>
                <p class="report-description">
                    Comprehensive weekly analysis with trend identification and progress tracking
                </p>
                <ul class="report-features">
                    <li>7-day progress analysis</li>
                    <li>Trend identification</li>
                    <li>Comparative performance</li>
                    <li>Training recommendations</li>
                </ul>
                <button class="generate-btn">Generate Weekly Report</button>
            </div>

            <div class="report-card" onclick="generateReport('monthly')">
                <div class="report-icon monthly">üìä</div>
                <h3 class="report-title">Monthly Reports</h3>
                <p class="report-description">
                    Long-term progress tracking with milestone achievements and goal adjustments
                </p>
                <ul class="report-features">
                    <li>Monthly progress tracking</li>
                    <li>Milestone achievements</li>
                    <li>Recovery phase analysis</li>
                    <li>Professional summaries</li>
                </ul>
                <button class="generate-btn">Generate Monthly Report</button>
            </div>

            <div class="report-card" onclick="generateReport('progress')">
                <div class="report-icon progress">üìã</div>
                <h3 class="report-title">Progress Comparison</h3>
                <p class="report-description">
                    Advanced analytics comparing your current performance with historical data
                </p>
                <ul class="report-features">
                    <li>Historical comparison</li>
                    <li>Improvement metrics</li>
                    <li>Predictive analysis</li>
                    <li>AI recommendations</li>
                </ul>
                <button class="generate-btn">Generate Progress Report</button>
            </div>
        </div>

        <!-- Report Display -->
        <div class="report-display" id="reportDisplay">
            <div class="report-header">
                <h2 id="reportTitle">Daily Rehabilitation Report</h2>
                <div class="report-meta" id="reportMeta">
                    Generated on <span id="reportDate"></span> for <span id="reportPeriod"></span>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="quick-stats" id="quickStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalSessions">0</div>
                    <div class="stat-label">Total Sessions</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="avgScore">0</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="totalDuration">0</div>
                    <div class="stat-label">Total Minutes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="improvementRate">0%</div>
                    <div class="stat-label">Improvement</div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-section">
                <h3 class="chart-title">Performance Trends</h3>
                <div class="chart-container" id="chartContainer">
                    <div class="chart-placeholder">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìä</div>
                        <div>Interactive charts will be displayed here</div>
                        <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.7;">
                            Progress visualization and trend analysis
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Section -->
            <div class="analysis-section">
                <h3 class="analysis-title">ü§ñ AI-Powered Analysis</h3>
                <div class="analysis-content" id="analysisContent">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 2em; margin-bottom: 10px;">üîÑ</div>
                        <div>AI analysis will be generated based on your selected report type...</div>
                    </div>
                </div>
                
                <div class="analysis-grid" id="analysisGrid">
                    <!-- Dynamic analysis items will be inserted here -->
                </div>
            </div>

            <!-- Export Section -->
            <div class="export-section">
                <h3 class="export-title">üì§ Export & Share</h3>
                <div class="export-buttons">
                    <button class="export-btn primary" onclick="exportPDF()">
                        üìÑ Export PDF
                    </button>
                    <button class="export-btn" onclick="exportCSV()">
                        üìä Export CSV Data
                    </button>
                    <button class="export-btn" onclick="exportExcel()">
                        üìà Export Excel
                    </button>
                    <button class="export-btn" onclick="shareReport()">
                        üì§ Share Report
                    </button>
                    <button class="export-btn" onclick="printReport()">
                        üñ®Ô∏è Print Report
                    </button>
                    <button class="export-btn" onclick="emailReport()">
                        üìß Email Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Generating Report...</h3>
            <p>Please wait while we analyze your data</p>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentReportType = null;
        let currentReportData = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const userData = localStorage.getItem('rehabtech_user');
            if (!userData) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(userData);
            console.log('Reports page loaded for user:', currentUser.name);

            // Set default date range (last 7 days)
            setDatePreset('week');
        });

        // Set date presets
        function setDatePreset(preset) {
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            // Remove active class from all buttons
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            
            // Set end date to today
            endDate.value = today.toISOString().split('T')[0];
            
            let daysBack = 0;
            switch (preset) {
                case 'today':
                    daysBack = 0;
                    break;
                case 'week':
                    daysBack = 7;
                    break;
                case 'month':
                    daysBack = 30;
                    break;
                case 'quarter':
                    daysBack = 90;
                    break;
                case 'year':
                    daysBack = 365;
                    break;
            }
            
            const startDateTime = new Date(today.getTime() - (daysBack * 24 * 60 * 60 * 1000));
            startDate.value = startDateTime.toISOString().split('T')[0];
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Generate report
        async function generateReport(type) {
            currentReportType = type;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Please select a date range', 'error');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showNotification('Start date cannot be after end date', 'error');
                return;
            }

            // Show loading
            showLoading(true);

            try {
                // Determine API endpoint based on report type
                let endpoint = '';
                switch (type) {
                    case 'daily':
                        endpoint = `/api/reports/daily?date=${endDate}`;
                        break;
                    case 'weekly':
                        endpoint = `/api/reports/weekly?weeks=1`;
                        break;
                    case 'monthly':
                        endpoint = `/api/reports/monthly?months=1`;
                        break;
                    case 'progress':
                        const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24));
                        endpoint = `/api/reports/progress?days=${days}`;
                        break;
                }

                // Call API
                const response = await fetch(endpoint, {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        currentReportData = data.report;
                        displayReport(type, data.report);
                    } else {
                        throw new Error(data.message || 'Failed to generate report');
                    }
                } else {
                    throw new Error('Network error');
                }
            } catch (error) {
                console.error('Report generation error:', error);
                // Generate mock report for demo
                currentReportData = generateMockReport(type, startDate, endDate);
                displayReport(type, currentReportData);
                showNotification('Report generated (demo mode)', 'warning');
            } finally {
                showLoading(false);
            }
        }

        // Display report
        function displayReport(type, reportData) {
            const reportDisplay = document.getElementById('reportDisplay');
            const reportTitle = document.getElementById('reportTitle');
            const reportMeta = document.getElementById('reportMeta');
            const reportDate = document.getElementById('reportDate');
            const reportPeriod = document.getElementById('reportPeriod');

            // Update header
            const titles = {
                daily: 'Daily Rehabilitation Report',
                weekly: 'Weekly Progress Report',
                monthly: 'Monthly Summary Report',
                progress: 'Progress Comparison Report'
            };

            reportTitle.textContent = titles[type];
            reportDate.textContent = new Date().toLocaleDateString();
            reportPeriod.textContent = getReportPeriodText();

            // Update quick stats
            updateQuickStats(reportData);

            // Generate chart
            generateChart(reportData);

            // Update analysis
            updateAnalysis(type, reportData);

            // Show report
            reportDisplay.classList.add('show');
            reportDisplay.scrollIntoView({ behavior: 'smooth' });

            showNotification('Report generated successfully!', 'success');
        }

        // Generate mock report data
        function generateMockReport(type, startDate, endDate) {
            const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
            
            return {
                type: type,
                period: `${startDate} to ${endDate}`,
                totalSessions: Math.floor(Math.random() * days * 2) + days,
                averageScore: Math.floor(Math.random() * 30) + 70,
                totalDuration: Math.floor(Math.random() * days * 30) + days * 15,
                improvementRate: Math.floor(Math.random() * 40) + 10,
                chartData: generateMockChartData(days),
                analysis: generateMockAnalysis(type),
                recommendations: generateMockRecommendations(type)
            };
        }

        // Generate mock chart data
        function generateMockChartData(days) {
            const data = [];
            for (let i = 0; i < Math.min(days, 30); i++) {
                const date = new Date();
                date.setDate(date.getDate() - (days - i - 1));
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    score: Math.floor(Math.random() * 40) + 60 + (i * 2), // Trending upward
                    duration: Math.floor(Math.random() * 20) + 20,
                    sessions: Math.floor(Math.random() * 3) + 1
                });
            }
            return data;
        }

        // Update quick stats
        function updateQuickStats(reportData) {
            document.getElementById('totalSessions').textContent = reportData.totalSessions || 0;
            document.getElementById('avgScore').textContent = reportData.averageScore || 0;
            document.getElementById('totalDuration').textContent = reportData.totalDuration || 0;
            document.getElementById('improvementRate').textContent = (reportData.improvementRate || 0) + '%';
        }

        // Generate chart
        function generateChart(reportData) {
            const chartContainer = document.getElementById('chartContainer');
            
            if (!reportData.chartData || reportData.chartData.length === 0) {
                chartContainer.innerHTML = '<div class="chart-placeholder"><div>No chart data available</div></div>';
                return;
            }

            // Create canvas for chart
            const canvas = document.createElement('canvas');
            canvas.width = chartContainer.offsetWidth - 40;
            canvas.height = 360;
            canvas.style.width = '100%';
            canvas.style.height = '360px';
            
            chartContainer.innerHTML = '';
            chartContainer.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            
            // Draw chart background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#e0e6ed';
            ctx.lineWidth = 1;
            
            // Draw grid lines
            for (let i = 0; i <= 10; i++) {
                const x = (canvas.width / 10) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let i = 0; i <= 8; i++) {
                const y = (canvas.height / 8) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Draw data line
            if (reportData.chartData.length > 1) {
                const maxScore = Math.max(...reportData.chartData.map(d => d.score));
                const minScore = Math.min(...reportData.chartData.map(d => d.score));
                const scoreRange = maxScore - minScore || 1;
                
                ctx.strokeStyle = '#4facfe';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                reportData.chartData.forEach((point, index) => {
                    const x = (index / (reportData.chartData.length - 1)) * canvas.width;
                    const y = canvas.height - ((point.score - minScore) / scoreRange) * canvas.height;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    
                    // Draw data points
                    ctx.fillStyle = '#4facfe';
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                });
                
                ctx.stroke();
            }

            // Add labels
            ctx.font = '14px Arial';
            ctx.fillStyle = '#333';
            ctx.fillText('Progress Score Over Time', 20, 30);
            
            // Add legend
            ctx.fillStyle = '#4facfe';
            ctx.fillRect(20, canvas.height - 30, 20, 3);
            ctx.fillStyle = '#333';
            ctx.fillText('Performance Score', 50, canvas.height - 25);
        }

        // Update analysis
        function updateAnalysis(type, reportData) {
            const analysisContent = document.getElementById('analysisContent');
            const analysisGrid = document.getElementById('analysisGrid');
            
            // Update main analysis content
            if (reportData.analysis) {
                analysisContent.innerHTML = reportData.analysis;
            } else {
                analysisContent.innerHTML = generateMockAnalysis(type);
            }
            
            // Update analysis grid
            const analysisItems = [
                {
                    title: 'Performance Trend',
                    content: reportData.improvementRate > 0 ? 
                        `Showing positive improvement of ${reportData.improvementRate}% over the selected period.` :
                        'Performance has remained stable. Consider adjusting training intensity.'
                },
                {
                    title: 'Session Consistency',
                    content: reportData.totalSessions > 10 ? 
                        'Excellent session consistency. Regular training is key to recovery.' :
                        'Consider increasing training frequency for optimal results.'
                },
                {
                    title: 'Goal Achievement',
                    content: reportData.averageScore > 80 ? 
                        'Exceeding performance goals. Ready for next rehabilitation phase.' :
                        'Good progress towards goals. Continue current training program.'
                },
                {
                    title: 'Recommendations',
                    content: reportData.recommendations || generateMockRecommendations(type)
                }
            ];
            
            analysisGrid.innerHTML = analysisItems.map(item => `
                <div class="analysis-item">
                    <h4>${item.title}</h4>
                    <p>${item.content}</p>
                </div>
            `).join('');
        }

        // Generate mock analysis
        function generateMockAnalysis(type) {
            const analyses = {
                daily: `
                    <h4>üéØ Today's Performance Summary</h4>
                    <p>Your rehabilitation session today shows excellent engagement and consistent performance. Key achievements include improved range of motion and sustained force output during exercises.</p>
                    <p><strong>Highlights:</strong> Completed all planned exercises with good form and maintained target heart rate throughout the session.</p>
                `,
                weekly: `
                    <h4>üìà Weekly Progress Analysis</h4>
                    <p>This week demonstrates significant improvement in both strength and mobility metrics. Your consistency in training has resulted in measurable gains across all key performance indicators.</p>
                    <p><strong>Key Improvements:</strong> 15% increase in average force output and 8% improvement in range of motion compared to last week.</p>
                `,
                monthly: `
                    <h4>üèÜ Monthly Achievement Summary</h4>
                    <p>Excellent progress over the past month with steady improvements in all rehabilitation goals. Your dedication to the program is clearly reflected in the substantial gains achieved.</p>
                    <p><strong>Major Milestones:</strong> Achieved 85% of target strength levels and exceeded flexibility goals by 12%.</p>
                `,
                progress: `
                    <h4>üîç Comprehensive Progress Analysis</h4>
                    <p>Your rehabilitation journey shows remarkable improvement trends with consistent upward trajectory in key metrics. The data indicates successful adaptation to training protocols.</p>
                    <p><strong>Overall Assessment:</strong> Performance scores have improved by 23% over the analysis period, indicating excellent rehabilitation progress.</p>
                `
            };
            
            return analyses[type] || analyses.daily;
        }

        // Generate mock recommendations
        function generateMockRecommendations(type) {
            const recommendations = {
                daily: 'Continue current intensity level. Focus on form over speed.',
                weekly: 'Consider progressing to intermediate exercises. Increase session duration by 5 minutes.',
                monthly: 'Ready for advanced rehabilitation phase. Consult with therapist for program update.',
                progress: 'Excellent progress trajectory. Maintain current program with gradual intensity increases.'
            };
            
            return recommendations[type] || recommendations.daily;
        }

        // Helper functions
        function getReportPeriodText() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate === endDate) {
                return new Date(startDate).toLocaleDateString();
            } else {
                return `${new Date(startDate).toLocaleDateString()} - ${new Date(endDate).toLocaleDateString()}`;
            }
        }

        // Export functions
        function exportPDF() {
            showNotification('PDF export feature coming soon!', 'info');
        }

        function exportCSV() {
            if (!currentReportData || !currentReportData.chartData) {
                showNotification('No data to export', 'warning');
                return;
            }

            const csvContent = "data:text/csv;charset=utf-8," 
                + "Date,Score,Duration,Sessions\n"
                + currentReportData.chartData.map(row => [
                    row.date,
                    row.score,
                    row.duration,
                    row.sessions
                ].join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `rehabtech_report_${currentReportType}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('CSV data exported successfully!', 'success');
        }

        function exportExcel() {
            showNotification('Excel export feature coming soon!', 'info');
        }

        function shareReport() {
            if (navigator.share) {
                navigator.share({
                    title: 'Regenix Report',
                    text: `My ${currentReportType} rehabilitation report`,
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const reportUrl = window.location.href;
                navigator.clipboard.writeText(reportUrl).then(() => {
                    showNotification('Report link copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('Unable to share report', 'error');
                });
            }
        }

        function printReport() {
            window.print();
        }

        function emailReport() {
            const subject = encodeURIComponent(`Regenix ${currentReportType} Report`);
            const body = encodeURIComponent(`Hi,

I'm sharing my ${currentReportType} rehabilitation report from Regenix.

Report Summary:
- Total Sessions: ${currentReportData?.totalSessions || 0}
- Average Score: ${currentReportData?.averageScore || 0}
- Total Duration: ${currentReportData?.totalDuration || 0} minutes
- Improvement Rate: ${currentReportData?.improvementRate || 0}%

Generated on: ${new Date().toLocaleDateString()}

Best regards,
${currentUser.name}`);

            window.open(`mailto:?subject=${subject}&body=${body}`);
        }

        // Show loading overlay
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // Show notification
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease;
                max-width: 300px;
            `;
            
            // Set color based on type
            switch (type) {
                case 'success':
                    notification.style.background = '#27ae60';
                    break;
                case 'error':
                    notification.style.background = '#e74c3c';
                    break;
                case 'warning':
                    notification.style.background = '#f39c12';
                    break;
                default:
                    notification.style.background = '#3498db';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('rehabtech_user');
                window.location.href = 'login.html';
            }
        }

        // Auto-refresh functionality
        function setupAutoRefresh() {
            // Auto-refresh data every 5 minutes if a report is displayed
            setInterval(() => {
                if (currentReportType && document.getElementById('reportDisplay').classList.contains('show')) {
                    console.log('Auto-refreshing report data...');
                    generateReport(currentReportType);
                }
            }, 5 * 60 * 1000); // 5 minutes
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName === 'INPUT') return;

            switch (event.key) {
                case '1':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        generateReport('daily');
                    }
                    break;
                case '2':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        generateReport('weekly');
                    }
                    break;
                case '3':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        generateReport('monthly');
                    }
                    break;
                case '4':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        generateReport('progress');
                    }
                    break;
                case 'p':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        printReport();
                    }
                    break;
                case 'e':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        exportCSV();
                    }
                    break;
            }
        });

        // Advanced chart generation with multiple data series
        function generateAdvancedChart(reportData) {
            const chartContainer = document.getElementById('chartContainer');
            
            if (!reportData.chartData || reportData.chartData.length === 0) {
                chartContainer.innerHTML = '<div class="chart-placeholder"><div>No chart data available</div></div>';
                return;
            }

            // Create canvas for chart
            const canvas = document.createElement('canvas');
            canvas.width = chartContainer.offsetWidth - 40;
            canvas.height = 360;
            canvas.style.width = '100%';
            canvas.style.height = '360px';
            
            chartContainer.innerHTML = '';
            chartContainer.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw chart background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Chart margins
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };
            const chartWidth = canvas.width - margin.left - margin.right;
            const chartHeight = canvas.height - margin.top - margin.bottom;
            
            // Draw grid
            ctx.strokeStyle = '#e0e6ed';
            ctx.lineWidth = 1;
            
            // Vertical grid lines
            for (let i = 0; i <= 10; i++) {
                const x = margin.left + (chartWidth / 10) * i;
                ctx.beginPath();
                ctx.moveTo(x, margin.top);
                ctx.lineTo(x, margin.top + chartHeight);
                ctx.stroke();
            }
            
            // Horizontal grid lines
            for (let i = 0; i <= 8; i++) {
                const y = margin.top + (chartHeight / 8) * i;
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(margin.left + chartWidth, y);
                ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // X-axis
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top + chartHeight);
            ctx.lineTo(margin.left + chartWidth, margin.top + chartHeight);
            ctx.stroke();
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + chartHeight);
            ctx.stroke();

            // Draw data lines
            if (reportData.chartData.length > 1) {
                const maxScore = Math.max(...reportData.chartData.map(d => d.score));
                const minScore = Math.min(...reportData.chartData.map(d => d.score));
                const scoreRange = maxScore - minScore || 1;
                
                // Score line
                ctx.strokeStyle = '#4facfe';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                reportData.chartData.forEach((point, index) => {
                    const x = margin.left + (index / (reportData.chartData.length - 1)) * chartWidth;
                    const y = margin.top + chartHeight - ((point.score - minScore) / scoreRange) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
                
                // Draw data points
                ctx.fillStyle = '#4facfe';
                reportData.chartData.forEach((point, index) => {
                    const x = margin.left + (index / (reportData.chartData.length - 1)) * chartWidth;
                    const y = margin.top + chartHeight - ((point.score - minScore) / scoreRange) * chartHeight;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    ctx.fill();
                });
                
                // Duration bars (secondary data)
                if (reportData.chartData.some(d => d.duration)) {
                    const maxDuration = Math.max(...reportData.chartData.map(d => d.duration));
                    ctx.fillStyle = 'rgba(255, 107, 107, 0.6)';
                    
                    reportData.chartData.forEach((point, index) => {
                        const x = margin.left + (index / (reportData.chartData.length - 1)) * chartWidth;
                        const barHeight = (point.duration / maxDuration) * (chartHeight * 0.3);
                        const y = margin.top + chartHeight - barHeight;
                        
                        ctx.fillRect(x - 8, y, 16, barHeight);
                    });
                }
            }

            // Add labels and legend
            ctx.font = 'bold 16px Arial';
            ctx.fillStyle = '#2c3e50';
            ctx.textAlign = 'center';
            ctx.fillText('Performance Trends Over Time', canvas.width / 2, 25);
            
            // Y-axis label
            ctx.save();
            ctx.translate(20, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Performance Score', 0, 0);
            ctx.restore();
            
            // X-axis label
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#2c3e50';
            ctx.fillText('Time Period', canvas.width / 2, canvas.height - 10);
            
            // Legend
            const legendY = margin.top + 20;
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            
            // Score legend
            ctx.fillStyle = '#4facfe';
            ctx.fillRect(margin.left, legendY, 20, 3);
            ctx.fillStyle = '#333';
            ctx.fillText('Performance Score', margin.left + 30, legendY + 10);
            
            // Duration legend
            ctx.fillStyle = 'rgba(255, 107, 107, 0.6)';
            ctx.fillRect(margin.left + 150, legendY, 16, 12);
            ctx.fillStyle = '#333';
            ctx.fillText('Session Duration', margin.left + 180, legendY + 10);
        }

        // Data export with multiple formats
        function exportAdvancedData() {
            if (!currentReportData) {
                showNotification('No data to export', 'warning');
                return;
            }

            const exportData = {
                reportInfo: {
                    type: currentReportType,
                    period: getReportPeriodText(),
                    generated: new Date().toISOString(),
                    user: currentUser.name
                },
                summary: {
                    totalSessions: currentReportData.totalSessions,
                    averageScore: currentReportData.averageScore,
                    totalDuration: currentReportData.totalDuration,
                    improvementRate: currentReportData.improvementRate
                },
                chartData: currentReportData.chartData,
                analysis: currentReportData.analysis,
                recommendations: currentReportData.recommendations
            };

            // Create downloadable JSON file
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `rehabtech_report_${currentReportType}_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Advanced data export completed!', 'success');
        }

        // Initialize page features
        document.addEventListener('DOMContentLoaded', function() {
            // Setup auto-refresh
            setupAutoRefresh();
            
            // Add keyboard shortcut info
            const shortcutInfo = document.createElement('div');
            shortcutInfo.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 10px 15px;
                border-radius: 20px;
                font-size: 0.8em;
                z-index: 1000;
                max-width: 200px;
            `;
            shortcutInfo.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">‚å®Ô∏è Shortcuts:</div>
                <div>Ctrl+1-4: Generate reports</div>
                <div>Ctrl+P: Print</div>
                <div>Ctrl+E: Export CSV</div>
            `;
            document.body.appendChild(shortcutInfo);
            
            // Auto-hide shortcut info after 10 seconds
            setTimeout(() => {
                shortcutInfo.style.display = 'none';
            }, 10000);
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(300px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(300px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Progressive Web App features
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('SW registered for reports'))
                .catch(error => console.log('SW registration failed'));
        }

        // Save report history
        function saveReportHistory(reportType, reportData) {
            const history = JSON.parse(localStorage.getItem('rehabtech_report_history') || '[]');
            
            history.unshift({
                id: Date.now(),
                type: reportType,
                data: reportData,
                user_id: currentUser.id,
                generated_at: new Date().toISOString()
            });
            
            // Keep only last 50 reports
            if (history.length > 50) {
                history.splice(50);
            }
            
            localStorage.setItem('rehabtech_report_history', JSON.stringify(history));
        }

        // Load report history
        function loadReportHistory() {
            const history = JSON.parse(localStorage.getItem('rehabtech_report_history') || '[]');
            return history.filter(report => report.user_id === currentUser.id);
        }

        // Add report history functionality to the interface
        function showReportHistory() {
            const history = loadReportHistory();
            
            if (history.length === 0) {
                showNotification('No report history available', 'info');
                return;
            }
            
            // Create modal to show history
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 20px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            `;
            
            content.innerHTML = `
                <h3 style="margin-bottom: 20px; text-align: center;">üìã Report History</h3>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${history.slice(0, 20).map(report => `
                        <div style="padding: 15px; border: 1px solid #e0e6ed; border-radius: 10px; margin-bottom: 10px; cursor: pointer;"
                             onclick="loadHistoricalReport('${report.id}')">
                            <div style="font-weight: bold; color: #2c3e50;">${report.type.charAt(0).toUpperCase() + report.type.slice(1)} Report</div>
                            <div style="color: #7f8c8d; font-size: 0.9em;">${new Date(report.generated_at).toLocaleString()}</div>
                        </div>
                    `).join('')}
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                            style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 20px; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        // Load historical report
        function loadHistoricalReport(reportId) {
            const history = loadReportHistory();
            const report = history.find(r => r.id == reportId);
            
            if (report) {
                currentReportType = report.type;
                currentReportData = report.data;
                displayReport(report.type, report.data);
                
                // Close modal
                const modal = document.querySelector('[style*="position: fixed"][style*="background: rgba(0, 0, 0, 0.5)"]');
                if (modal) modal.remove();
                
                showNotification('Historical report loaded', 'success');
            }
        }

        // Add report history button to export section
        document.addEventListener('DOMContentLoaded', function() {
            const exportButtons = document.querySelector('.export-buttons');
            if (exportButtons) {
                const historyBtn = document.createElement('button');
                historyBtn.className = 'export-btn';
                historyBtn.innerHTML = 'üìã Report History';
                historyBtn.onclick = showReportHistory;
                exportButtons.appendChild(historyBtn);
            }
        });

        // Save current report to history when generated
        function displayReport(type, reportData) {
            // ... existing displayReport code ...
            
            // Save to history
            saveReportHistory(type, reportData);
            
            // ... rest of existing code ...
        }
    </script>
</body>